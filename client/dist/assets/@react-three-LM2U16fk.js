import{r as m,j as T}from"./react-CYTwke-y.js";import{m as fe,T as Se,R as Mt,f as St,n as Je,O as xt,o as Pt,S as xe,p as de,q as Rt,A as Ot,r as Qe,V as I,s as jt,t as kt,u as Oe,a as Lt,v as At,w as Tt,x as Dt,y as zt,z as It,E as Ft,G as ae,c as Bt,J as Ht,K as je,Q as Gt,M as Wt,X as Ze,Y as Ut,Z as $t,_ as Nt,$ as qt,a0 as Vt,a1 as Xt,a2 as Yt,H as et,W as Be,a3 as Kt,a4 as He}from"./three-D3BE0AKv.js";import{c as Ge}from"./debounce-eJprFik_.js";import{F as Jt,u as Qt}from"./its-fine-BJQM3-Eh.js";import{R as Zt,c as q}from"./react-reconciler-nf9IuqLV.js";import{s as We}from"./scheduler-CzFDRTuY.js";import"./react-dom-CM8lys4N.js";import"./maath-SK8aBDdz.js";import{_ as ce}from"./@babel-CF3RwP-h.js";import{D as er,G as ke,a as tr,M as pe,R as rr,E as nr,b as or}from"./three-stdlib-WYq69YyO.js";import{H as ir,G as sr}from"./@monogrid-WiDrBek-.js";import{c as tt}from"./zustand-CCIEgNSz.js";import{s as ar,p as lr,c as cr}from"./suspend-react-BKIKQNXN.js";const Le={},Ae=e=>void Object.assign(Le,e);function ur(e,t){function o(r,{args:n=[],attach:l,...v},h){let w=`${r[0].toUpperCase()}${r.slice(1)}`,d;if(r==="primitive"){if(v.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const a=v.object;d=$(a,{type:r,root:h,attach:l,primitive:!0})}else{const a=Le[w];if(!a)throw new Error(`R3F: ${w} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(n))throw new Error("R3F: The args prop must be an array!");d=$(new a(...n),{type:r,root:h,attach:l,memoizedProps:{args:n}})}return d.__r3f.attach===void 0&&(d instanceof jt?d.__r3f.attach="geometry":d instanceof kt&&(d.__r3f.attach="material")),w!=="inject"&&me(d,v),d}function i(r,n){let l=!1;if(n){var v,h;(v=n.__r3f)!=null&&v.attach?ve(r,n,n.__r3f.attach):n.isObject3D&&r.isObject3D&&(r.add(n),l=!0),l||(h=r.__r3f)==null||h.objects.push(n),n.__r3f||$(n,{}),n.__r3f.parent=r,Re(n),N(n)}}function c(r,n,l){let v=!1;if(n){var h,w;if((h=n.__r3f)!=null&&h.attach)ve(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){n.parent=r,n.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:n});const d=r.children.filter(p=>p!==n),a=d.indexOf(l);r.children=[...d.slice(0,a),n,...d.slice(a)],v=!0}v||(w=r.__r3f)==null||w.objects.push(n),n.__r3f||$(n,{}),n.__r3f.parent=r,Re(n),N(n)}}function s(r,n,l=!1){r&&[...r].forEach(v=>y(n,v,l))}function y(r,n,l){if(n){var v,h,w;if(n.__r3f&&(n.__r3f.parent=null),(v=r.__r3f)!=null&&v.objects&&(r.__r3f.objects=r.__r3f.objects.filter(_=>_!==n)),(h=n.__r3f)!=null&&h.attach)Ve(r,n,n.__r3f.attach);else if(n.isObject3D&&r.isObject3D){var d;r.remove(n),(d=n.__r3f)!=null&&d.root&&yr(le(n),n)}const p=(w=n.__r3f)==null?void 0:w.primitive,b=!p&&(l===void 0?n.dispose!==null:l);if(!p){var a;s((a=n.__r3f)==null?void 0:a.objects,n,b),s(n.children,n,b)}if(delete n.__r3f,b&&n.dispose&&n.type!=="Scene"){const _=()=>{try{n.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?We.unstable_scheduleCallback(We.unstable_IdlePriority,_):_()}N(r)}}function f(r,n,l,v){var h;const w=(h=r.__r3f)==null?void 0:h.parent;if(!w)return;const d=o(n,l,r.__r3f.root);if(r.children){for(const a of r.children)a.__r3f&&i(d,a);r.children=r.children.filter(a=>!a.__r3f)}r.__r3f.objects.forEach(a=>i(d,a)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||y(w,r),d.parent&&(d.__r3f.autoRemovedBeforeAppend=!0),i(w,d),d.raycast&&d.__r3f.eventCount&&le(d).getState().internal.interaction.push(d),[v,v.alternate].forEach(a=>{a!==null&&(a.stateNode=d,a.ref&&(typeof a.ref=="function"?a.ref(d):a.ref.current=d))})}const u=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Zt({createInstance:o,removeChild:y,appendChild:i,appendInitialChild:i,insertBefore:c,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,n)=>{if(!n)return;const l=r.getState().scene;l.__r3f&&(l.__r3f.root=r,i(l,n))},removeChildFromContainer:(r,n)=>{n&&y(r.getState().scene,n)},insertInContainerBefore:(r,n,l)=>{if(!n||!l)return;const v=r.getState().scene;v.__r3f&&c(v,n,l)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var n;return!!((n=r==null?void 0:r.__r3f)!=null?n:{}).handlers},prepareUpdate(r,n,l,v){var h;if(((h=r==null?void 0:r.__r3f)!=null?h:{}).primitive&&v.object&&v.object!==r)return[!0];{const{args:d=[],children:a,...p}=v,{args:b=[],children:_,...E}=l;if(!Array.isArray(d))throw new Error("R3F: the args prop must be an array!");if(d.some((S,x)=>S!==b[x]))return[!0];const M=lt(r,p,E,!0);return M.changes.length?[!1,M]:null}},commitUpdate(r,[n,l],v,h,w,d){n?f(r,v,w,d):me(r,l)},commitMount(r,n,l,v){var h;const w=(h=r.__r3f)!=null?h:{};r.raycast&&w.handlers&&w.eventCount&&le(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>$(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var n;const{attach:l,parent:v}=(n=r.__r3f)!=null?n:{};l&&v&&Ve(v,r,l),r.isObject3D&&(r.visible=!1),N(r)},unhideInstance(r,n){var l;const{attach:v,parent:h}=(l=r.__r3f)!=null?l:{};v&&h&&ve(h,r,v),(r.isObject3D&&n.visible==null||n.visible)&&(r.visible=!0),N(r)},createTextInstance:u,hideTextInstance:u,unhideTextInstance:u,getCurrentEventPriority:()=>t?t():q.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&j.fun(performance.now)?performance.now:j.fun(Date.now)?Date.now:()=>0,scheduleTimeout:j.fun(setTimeout)?setTimeout:void 0,cancelTimeout:j.fun(clearTimeout)?clearTimeout:void 0}),applyProps:me}}var Ue,$e;const he=e=>"colorSpace"in e||"outputColorSpace"in e,rt=()=>{var e;return(e=Le.ColorManagement)!=null?e:null},nt=e=>e&&e.isOrthographicCamera,fr=e=>e&&e.hasOwnProperty("current"),Z=typeof window<"u"&&((Ue=window.document)!=null&&Ue.createElement||(($e=window.navigator)==null?void 0:$e.product)==="ReactNative")?m.useLayoutEffect:m.useEffect;function ot(e){const t=m.useRef(e);return Z(()=>void(t.current=e),[e]),t}function dr({set:e}){return Z(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class it extends m.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}it.getDerivedStateFromError=()=>({error:!0});const st="__default",Ne=new Map,pr=e=>e&&!!e.memoized&&!!e.changes;function at(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const K=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function le(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const j={obj:e=>e===Object(e)&&!j.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:c=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(j.str(e)||j.num(e)||j.boo(e))return e===t;const s=j.obj(e);if(s&&i==="reference")return e===t;const y=j.arr(e);if(y&&o==="reference")return e===t;if((y||s)&&e===t)return!0;let f;for(f in e)if(!(f in t))return!1;if(s&&o==="shallow"&&i==="shallow"){for(f in c?t:e)if(!j.equ(e[f],t[f],{strict:c,objects:"reference"}))return!1}else for(f in c?t:e)if(e[f]!==t[f])return!1;if(j.und(f)){if(y&&e.length===0&&t.length===0||s&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function hr(e){const t={nodes:{},materials:{}};return e&&e.traverse(o=>{o.name&&(t.nodes[o.name]=o),o.material&&!t.materials[o.material.name]&&(t.materials[o.material.name]=o.material)}),t}function vr(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function $(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Pe(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),c=i.pop();return o=i.reduce((s,y)=>s[y],e),{target:o,key:c}}else return{target:o,key:t}}const qe=/-\d+$/;function ve(e,t,o){if(j.str(o)){if(qe.test(o)){const s=o.replace(qe,""),{target:y,key:f}=Pe(e,s);Array.isArray(y[f])||(y[f]=[])}const{target:i,key:c}=Pe(e,o);t.__r3f.previousAttach=i[c],i[c]=t}else t.__r3f.previousAttach=o(e,t)}function Ve(e,t,o){var i,c;if(j.str(o)){const{target:s,key:y}=Pe(e,o),f=t.__r3f.previousAttach;f===void 0?delete s[y]:s[y]=f}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(c=t.__r3f)==null||delete c.previousAttach}function lt(e,{children:t,key:o,ref:i,...c},{children:s,key:y,ref:f,...u}={},g=!1){const r=e.__r3f,n=Object.entries(c),l=[];if(g){const h=Object.keys(u);for(let w=0;w<h.length;w++)c.hasOwnProperty(h[w])||n.unshift([h[w],st+"remove"])}n.forEach(([h,w])=>{var d;if((d=e.__r3f)!=null&&d.primitive&&h==="object"||j.equ(w,u[h]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(h))return l.push([h,w,!0,[]]);let a=[];h.includes("-")&&(a=h.split("-")),l.push([h,w,!1,a]);for(const p in c){const b=c[p];p.startsWith(`${h}-`)&&l.push([p,b,!1,p.split("-")])}});const v={...c};return r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.args&&(v.args=r.memoizedProps.args),r!=null&&r.memoizedProps&&r!=null&&r.memoizedProps.attach&&(v.attach=r.memoizedProps.attach),{memoized:v,changes:l}}const mr=typeof process<"u"&&!1;function me(e,t){var o;const i=e.__r3f,c=i==null?void 0:i.root,s=c==null||c.getState==null?void 0:c.getState(),{memoized:y,changes:f}=pr(t)?t:lt(e,t),u=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=y);for(let r=0;r<f.length;r++){let[n,l,v,h]=f[r];if(he(e)){const p="srgb",b="srgb-linear";n==="encoding"?(n="colorSpace",l=l===3001?p:b):n==="outputEncoding"&&(n="outputColorSpace",l=l===3001?p:b)}let w=e,d=w[n];if(h.length&&(d=h.reduce((a,p)=>a[p],e),!(d&&d.set))){const[a,...p]=h.reverse();w=p.reverse().reduce((b,_)=>b[_],e),n=a}if(l===st+"remove")if(w.constructor){let a=Ne.get(w.constructor);a||(a=new w.constructor,Ne.set(w.constructor,a)),l=a[n]}else l=0;if(v&&i)l?i.handlers[n]=l:delete i.handlers[n],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof fe)){if(Array.isArray(l))d.fromArray?d.fromArray(l):d.set(...l);else if(d.copy&&l&&l.constructor&&(mr?d.constructor.name===l.constructor.name:d.constructor===l.constructor))d.copy(l);else if(l!==void 0){const a=d instanceof Oe;!a&&d.setScalar?d.setScalar(l):d instanceof fe&&l instanceof fe?d.mask=l.mask:d.set(l),!rt()&&s&&!s.linear&&a&&d.convertSRGBToLinear()}}else if(w[n]=l,w[n]instanceof Se&&w[n].format===Mt&&w[n].type===St&&s){const a=w[n];he(a)&&he(s.gl)?a.colorSpace=s.gl.outputColorSpace:a.encoding=s.gl.outputEncoding}N(e)}if(i&&i.parent&&e.raycast&&u!==i.eventCount){const r=le(e).getState().internal,n=r.interaction.indexOf(e);n>-1&&r.interaction.splice(n,1),i.eventCount&&r.interaction.push(e)}return!(f.length===1&&f[0][0]==="onUpdate")&&f.length&&(o=e.__r3f)!=null&&o.parent&&Re(e),e}function N(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function Re(e){e.onUpdate==null||e.onUpdate(e)}function ct(e,t){e.manual||(nt(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ne(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function gr(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return q.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return q.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return q.ContinuousEventPriority;default:return q.DefaultEventPriority}}function ut(e,t,o,i){const c=o.get(t);c&&(o.delete(t),o.size===0&&(e.delete(i),c.target.releasePointerCapture(i)))}function yr(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,c)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(c)}),o.capturedMap.forEach((i,c)=>{ut(o.capturedMap,t,i,c)})}function wr(e){function t(u){const{internal:g}=e.getState(),r=u.offsetX-g.initialClick[0],n=u.offsetY-g.initialClick[1];return Math.round(Math.sqrt(r*r+n*n))}function o(u){return u.filter(g=>["Move","Over","Enter","Out","Leave"].some(r=>{var n;return(n=g.__r3f)==null?void 0:n.handlers["onPointer"+r]}))}function i(u,g){const r=e.getState(),n=new Set,l=[],v=g?g(r.internal.interaction):r.internal.interaction;for(let a=0;a<v.length;a++){const p=K(v[a]);p&&(p.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(u,r);function h(a){const p=K(a);if(!p||!p.events.enabled||p.raycaster.camera===null)return[];if(p.raycaster.camera===void 0){var b;p.events.compute==null||p.events.compute(u,p,(b=p.previousRoot)==null?void 0:b.getState()),p.raycaster.camera===void 0&&(p.raycaster.camera=null)}return p.raycaster.camera?p.raycaster.intersectObject(a,!0):[]}let w=v.flatMap(h).sort((a,p)=>{const b=K(a.object),_=K(p.object);return!b||!_?a.distance-p.distance:_.events.priority-b.events.priority||a.distance-p.distance}).filter(a=>{const p=ne(a);return n.has(p)?!1:(n.add(p),!0)});r.events.filter&&(w=r.events.filter(w,r));for(const a of w){let p=a.object;for(;p;){var d;(d=p.__r3f)!=null&&d.eventCount&&l.push({...a,eventObject:p}),p=p.parent}}if("pointerId"in u&&r.internal.capturedMap.has(u.pointerId))for(let a of r.internal.capturedMap.get(u.pointerId).values())n.has(ne(a.intersection))||l.push(a.intersection);return l}function c(u,g,r,n){const l=e.getState();if(u.length){const v={stopped:!1};for(const h of u){const w=K(h.object)||l,{raycaster:d,pointer:a,camera:p,internal:b}=w,_=new I(a.x,a.y,0).unproject(p),E=P=>{var C,O;return(C=(O=b.capturedMap.get(P))==null?void 0:O.has(h.eventObject))!=null?C:!1},M=P=>{const C={intersection:h,target:g.target};b.capturedMap.has(P)?b.capturedMap.get(P).set(h.eventObject,C):b.capturedMap.set(P,new Map([[h.eventObject,C]])),g.target.setPointerCapture(P)},S=P=>{const C=b.capturedMap.get(P);C&&ut(b.capturedMap,h.eventObject,C,P)};let x={};for(let P in g){let C=g[P];typeof C!="function"&&(x[P]=C)}let R={...h,...x,pointer:a,intersections:u,stopped:v.stopped,delta:r,unprojectedPoint:_,ray:d.ray,camera:p,stopPropagation(){const P="pointerId"in g&&b.capturedMap.get(g.pointerId);if((!P||P.has(h.eventObject))&&(R.stopped=v.stopped=!0,b.hovered.size&&Array.from(b.hovered.values()).find(C=>C.eventObject===h.eventObject))){const C=u.slice(0,u.indexOf(h));s([...C,h])}},target:{hasPointerCapture:E,setPointerCapture:M,releasePointerCapture:S},currentTarget:{hasPointerCapture:E,setPointerCapture:M,releasePointerCapture:S},nativeEvent:g};if(n(R),v.stopped===!0)break}}return u}function s(u){const{internal:g}=e.getState();for(const r of g.hovered.values())if(!u.length||!u.find(n=>n.object===r.object&&n.index===r.index&&n.instanceId===r.instanceId)){const l=r.eventObject.__r3f,v=l==null?void 0:l.handlers;if(g.hovered.delete(ne(r)),l!=null&&l.eventCount){const h={...r,intersections:u};v.onPointerOut==null||v.onPointerOut(h),v.onPointerLeave==null||v.onPointerLeave(h)}}}function y(u,g){for(let r=0;r<g.length;r++){const n=g[r].__r3f;n==null||n.handlers.onPointerMissed==null||n.handlers.onPointerMissed(u)}}function f(u){switch(u){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return g=>{const{internal:r}=e.getState();"pointerId"in g&&r.capturedMap.has(g.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(g.pointerId)&&(r.capturedMap.delete(g.pointerId),s([]))})}}return function(r){const{onPointerMissed:n,internal:l}=e.getState();l.lastEvent.current=r;const v=u==="onPointerMove",h=u==="onClick"||u==="onContextMenu"||u==="onDoubleClick",d=i(r,v?o:void 0),a=h?t(r):0;u==="onPointerDown"&&(l.initialClick=[r.offsetX,r.offsetY],l.initialHits=d.map(b=>b.eventObject)),h&&!d.length&&a<=2&&(y(r,l.interaction),n&&n(r)),v&&s(d);function p(b){const _=b.eventObject,E=_.__r3f,M=E==null?void 0:E.handlers;if(E!=null&&E.eventCount)if(v){if(M.onPointerOver||M.onPointerEnter||M.onPointerOut||M.onPointerLeave){const S=ne(b),x=l.hovered.get(S);x?x.stopped&&b.stopPropagation():(l.hovered.set(S,b),M.onPointerOver==null||M.onPointerOver(b),M.onPointerEnter==null||M.onPointerEnter(b))}M.onPointerMove==null||M.onPointerMove(b)}else{const S=M[u];S?(!h||l.initialHits.includes(_))&&(y(r,l.interaction.filter(x=>!l.initialHits.includes(x))),S(b)):h&&l.initialHits.includes(_)&&y(r,l.interaction.filter(x=>!l.initialHits.includes(x)))}}c(d,r,a,p)}}return{handlePointer:f}}const br=["set","get","setSize","setFrameloop","setDpr","events","invalidate","advance","size","viewport"],ft=e=>!!(e!=null&&e.render),Te=m.createContext(null),Er=(e,t)=>{const o=tt((f,u)=>{const g=new I,r=new I,n=new I;function l(a=u().camera,p=r,b=u().size){const{width:_,height:E,top:M,left:S}=b,x=_/E;p instanceof I?n.copy(p):n.set(...p);const R=a.getWorldPosition(g).distanceTo(n);if(nt(a))return{width:_/a.zoom,height:E/a.zoom,top:M,left:S,factor:1,distance:R,aspect:x};{const P=a.fov*Math.PI/180,C=2*Math.tan(P/2)*R,O=C*(_/E);return{width:O,height:C,top:M,left:S,factor:_/O,distance:R,aspect:x}}}let v;const h=a=>f(p=>({performance:{...p.performance,current:a}})),w=new Qe;return{set:f,get:u,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(a=1)=>e(u(),a),advance:(a,p)=>t(a,p,u()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new It,pointer:w,mouse:w,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const a=u();v&&clearTimeout(v),a.performance.current!==a.performance.min&&h(a.performance.min),v=setTimeout(()=>h(u().performance.max),a.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:a=>f(p=>({...p,events:{...p.events,...a}})),setSize:(a,p,b,_,E)=>{const M=u().camera,S={width:a,height:p,top:_||0,left:E||0,updateStyle:b};f(x=>({size:S,viewport:{...x.viewport,...l(M,r,S)}}))},setDpr:a=>f(p=>{const b=at(a);return{viewport:{...p.viewport,dpr:b,initialDpr:p.viewport.initialDpr||b}}}),setFrameloop:(a="always")=>{const p=u().clock;p.stop(),p.elapsedTime=0,a!=="never"&&(p.start(),p.elapsedTime=0),f(()=>({frameloop:a}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:m.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(a,p,b)=>{const _=u().internal;return _.priority=_.priority+(p>0?1:0),_.subscribers.push({ref:a,priority:p,store:b}),_.subscribers=_.subscribers.sort((E,M)=>E.priority-M.priority),()=>{const E=u().internal;E!=null&&E.subscribers&&(E.priority=E.priority-(p>0?1:0),E.subscribers=E.subscribers.filter(M=>M.ref!==a))}}}}}),i=o.getState();let c=i.size,s=i.viewport.dpr,y=i.camera;return o.subscribe(()=>{const{camera:f,size:u,viewport:g,gl:r,set:n}=o.getState();if(u.width!==c.width||u.height!==c.height||g.dpr!==s){var l;c=u,s=g.dpr,ct(f,u),r.setPixelRatio(g.dpr);const v=(l=u.updateStyle)!=null?l:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(u.width,u.height,v)}f!==y&&(y=f,n(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(f)}})))}),o.subscribe(f=>e(f)),o};let oe,_r=new Set,Cr=new Set,Mr=new Set;function ge(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function J(e,t){switch(e){case"before":return ge(_r,t);case"after":return ge(Cr,t);case"tail":return ge(Mr,t)}}let ye,we;function be(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ye=t.internal.subscribers,oe=0;oe<ye.length;oe++)we=ye[oe],we.ref.current(we.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Sr(e){let t=!1,o=!1,i,c,s;function y(g){c=requestAnimationFrame(y),t=!0,i=0,J("before",g),o=!0;for(const n of e.values()){var r;s=n.store.getState(),s.internal.active&&(s.frameloop==="always"||s.internal.frames>0)&&!((r=s.gl.xr)!=null&&r.isPresenting)&&(i+=be(g,s))}if(o=!1,J("after",g),i===0)return J("tail",g),t=!1,cancelAnimationFrame(c)}function f(g,r=1){var n;if(!g)return e.forEach(l=>f(l.store.getState(),r));(n=g.gl.xr)!=null&&n.isPresenting||!g.internal.active||g.frameloop==="never"||(r>1?g.internal.frames=Math.min(60,g.internal.frames+r):o?g.internal.frames=2:g.internal.frames=1,t||(t=!0,requestAnimationFrame(y)))}function u(g,r=!0,n,l){if(r&&J("before",g),n)be(g,n,l);else for(const v of e.values())be(g,v.store.getState());r&&J("after",g)}return{loop:y,invalidate:f,advance:u}}function De(){const e=m.useContext(Te);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function B(e=o=>o,t){return De()(e,t)}function dt(e,t=0){const o=De(),i=o.getState().internal.subscribe,c=ot(e);return Z(()=>i(c,t,o),[t,i,o]),null}const Xe=new WeakMap;function pt(e,t){return function(o,...i){let c=Xe.get(o);return c||(c=new o,Xe.set(o,c)),e&&e(c),Promise.all(i.map(s=>new Promise((y,f)=>c.load(s,u=>{u.scene&&Object.assign(u,hr(u.scene)),y(u)},t,u=>f(new Error(`Could not load ${s}: ${u==null?void 0:u.message}`))))))}}function H(e,t,o,i){const c=Array.isArray(t)?t:[t],s=ar(pt(o,i),[e,...c],{equal:j.equ});return Array.isArray(t)?s:s[0]}H.preload=function(e,t,o){const i=Array.isArray(t)?t:[t];return lr(pt(o),[e,...i])};H.clear=function(e,t){const o=Array.isArray(t)?t:[t];return cr([e,...o])};const V=new Map,{invalidate:Ye,advance:Ke}=Sr(V),{reconciler:Q,applyProps:D}=ur(V,gr),U={objects:"shallow",strict:!1},xr=(e,t)=>{const o=typeof e=="function"?e(t):e;return ft(o)?o:new Lt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Pr(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:c,top:s,left:y,updateStyle:f=o}=t;return{width:i,height:c,top:s,left:y,updateStyle:f}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:c,top:s,left:y}=e.parentElement.getBoundingClientRect();return{width:i,height:c,top:s,left:y,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Rr(e){const t=V.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const c=typeof reportError=="function"?reportError:console.error,s=i||Er(Ye,Ke),y=o||Q.createContainer(s,q.ConcurrentRoot,null,!1,null,"",c,null);t||V.set(e,{fiber:y,store:s});let f,u=!1,g;return{configure(r={}){let{gl:n,size:l,scene:v,events:h,onCreated:w,shadows:d=!1,linear:a=!1,flat:p=!1,legacy:b=!1,orthographic:_=!1,frameloop:E="always",dpr:M=[1,2],performance:S,raycaster:x,camera:R,onPointerMissed:P}=r,C=s.getState(),O=C.gl;C.gl||C.set({gl:O=xr(n,e)});let z=C.raycaster;z||C.set({raycaster:z=new Je});const{params:X,...ee}=x||{};if(j.equ(ee,z,U)||D(z,{...ee}),j.equ(X,z.params,U)||D(z,{params:{...z.params,...X}}),!C.camera||C.camera===g&&!j.equ(g,R,U)){g=R;const A=R instanceof At,k=A?R:_?new xt(0,0,0,0,.1,1e3):new Pt(75,0,.1,1e3);A||(k.position.z=5,R&&(D(k,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(k.manual=!0,k.updateProjectionMatrix())),!C.camera&&!(R!=null&&R.rotation)&&k.lookAt(0,0,0)),C.set({camera:k}),z.camera=k}if(!C.scene){let A;v instanceof xe?A=v:(A=new xe,v&&D(A,v)),C.set({scene:$(A)})}if(!C.xr){var Y;const A=(L,ue)=>{const re=s.getState();re.frameloop!=="never"&&Ke(L,!0,re,ue)},k=()=>{const L=s.getState();L.gl.xr.enabled=L.gl.xr.isPresenting,L.gl.xr.setAnimationLoop(L.gl.xr.isPresenting?A:null),L.gl.xr.isPresenting||Ye(L)},W={connect(){const L=s.getState().gl;L.xr.addEventListener("sessionstart",k),L.xr.addEventListener("sessionend",k)},disconnect(){const L=s.getState().gl;L.xr.removeEventListener("sessionstart",k),L.xr.removeEventListener("sessionend",k)}};typeof((Y=O.xr)==null?void 0:Y.addEventListener)=="function"&&W.connect(),C.set({xr:W})}if(O.shadowMap){const A=O.shadowMap.enabled,k=O.shadowMap.type;if(O.shadowMap.enabled=!!d,j.boo(d))O.shadowMap.type=de;else if(j.str(d)){var te;const W={basic:Tt,percentage:Dt,soft:de,variance:zt};O.shadowMap.type=(te=W[d])!=null?te:de}else j.obj(d)&&Object.assign(O.shadowMap,d);(A!==O.shadowMap.enabled||k!==O.shadowMap.type)&&(O.shadowMap.needsUpdate=!0)}const F=rt();F&&("enabled"in F?F.enabled=!b:"legacyMode"in F&&(F.legacyMode=b)),u||D(O,{outputEncoding:a?3e3:3001,toneMapping:p?Rt:Ot}),C.legacy!==b&&C.set(()=>({legacy:b})),C.linear!==a&&C.set(()=>({linear:a})),C.flat!==p&&C.set(()=>({flat:p})),n&&!j.fun(n)&&!ft(n)&&!j.equ(n,O,U)&&D(O,n),h&&!C.events.handlers&&C.set({events:h(s)});const G=Pr(e,l);return j.equ(G,C.size,U)||C.setSize(G.width,G.height,G.updateStyle,G.top,G.left),M&&C.viewport.dpr!==at(M)&&C.setDpr(M),C.frameloop!==E&&C.setFrameloop(E),C.onPointerMissed||C.set({onPointerMissed:P}),S&&!j.equ(S,C.performance,U)&&C.set(A=>({performance:{...A.performance,...S}})),f=w,u=!0,this},render(r){return u||this.configure(),Q.updateContainer(T.jsx(Or,{store:s,children:r,onCreated:f,rootElement:e}),y,null,()=>{}),s},unmount(){ht(e)}}}function Or({store:e,children:t,onCreated:o,rootElement:i}){return Z(()=>{const c=e.getState();c.set(s=>({internal:{...s.internal,active:!0}})),o&&o(c),e.getState().events.connected||c.events.connect==null||c.events.connect(i)},[]),T.jsx(Te.Provider,{value:e,children:t})}function ht(e,t){const o=V.get(e),i=o==null?void 0:o.fiber;if(i){const c=o==null?void 0:o.store.getState();c&&(c.internal.active=!1),Q.updateContainer(null,i,null,()=>{c&&setTimeout(()=>{try{var s,y,f,u;c.events.disconnect==null||c.events.disconnect(),(s=c.gl)==null||(y=s.renderLists)==null||y.dispose==null||y.dispose(),(f=c.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(u=c.gl)!=null&&u.xr&&c.xr.disconnect(),vr(c),V.delete(e)}catch{}},500)})}}function jr(e,t,o){return T.jsx(kr,{children:e,container:t,state:o},t.uuid)}function kr({state:e={},children:t,container:o}){const{events:i,size:c,...s}=e,y=De(),[f]=m.useState(()=>new Je),[u]=m.useState(()=>new Qe),g=m.useCallback((n,l)=>{const v={...n};Object.keys(n).forEach(w=>{(br.includes(w)||n[w]!==l[w]&&l[w])&&delete v[w]});let h;if(l&&c){const w=l.camera;h=n.viewport.getCurrentViewport(w,new I,c),w!==n.camera&&ct(w,c)}return{...v,scene:o,raycaster:f,pointer:u,mouse:u,previousRoot:y,events:{...n.events,...l==null?void 0:l.events,...i},size:{...n.size,...c},viewport:{...n.viewport,...h},...s}},[e]),[r]=m.useState(()=>{const n=y.getState();return tt((v,h)=>({...n,scene:o,raycaster:f,pointer:u,mouse:u,previousRoot:y,events:{...n.events,...i},size:{...n.size,...c},...s,set:v,get:h,setEvents:w=>v(d=>({...d,events:{...d.events,...w}}))}))});return m.useEffect(()=>{const n=y.subscribe(l=>r.setState(v=>g(l,v)));return()=>{n()}},[g]),m.useEffect(()=>{r.setState(n=>g(y.getState(),n))},[g]),m.useEffect(()=>()=>{r.destroy()},[]),T.jsx(T.Fragment,{children:Q.createPortal(T.jsx(Te.Provider,{value:r,children:t}),r,null)})}Q.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:m.version});const Ee={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Lr(e){const{handlePointer:t}=wr(e);return{priority:1,enabled:!0,compute(o,i,c){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Ee).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:c}=e.getState();(o=c.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(c.lastEvent.current)},connect:o=>{var i;const{set:c,events:s}=e.getState();s.disconnect==null||s.disconnect(),c(y=>({events:{...y.events,connected:o}})),Object.entries((i=s.handlers)!=null?i:[]).forEach(([y,f])=>{const[u,g]=Ee[y];o.addEventListener(u,f,{passive:g})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var c;Object.entries((c=i.handlers)!=null?c:[]).forEach(([s,y])=>{if(i&&i.connected instanceof HTMLElement){const[f]=Ee[s];i.connected.removeEventListener(f,y)}}),o(s=>({events:{...s.events,connected:void 0}}))}}}}function Ar({debounce:e,scroll:t,polyfill:o,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const c=o||typeof window<"u"&&window.ResizeObserver,[s,y]=m.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!c)return s.width=1280,s.height=800,[()=>{},s,()=>{}];const f=m.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s}),u=e?typeof e=="number"?e:e.scroll:null,g=e?typeof e=="number"?e:e.resize:null,r=m.useRef(!1);m.useEffect(()=>(r.current=!0,()=>void(r.current=!1)));const[n,l,v]=m.useMemo(()=>{const a=()=>{if(!f.current.element)return;const{left:p,top:b,width:_,height:E,bottom:M,right:S,x,y:R}=f.current.element.getBoundingClientRect(),P={left:p,top:b,width:_,height:E,bottom:M,right:S,x,y:R};f.current.element instanceof HTMLElement&&i&&(P.height=f.current.element.offsetHeight,P.width=f.current.element.offsetWidth),Object.freeze(P),r.current&&!Ir(f.current.lastBounds,P)&&y(f.current.lastBounds=P)};return[a,g?Ge(a,g):a,u?Ge(a,u):a]},[y,i,u,g]);function h(){f.current.scrollContainers&&(f.current.scrollContainers.forEach(a=>a.removeEventListener("scroll",v,!0)),f.current.scrollContainers=null),f.current.resizeObserver&&(f.current.resizeObserver.disconnect(),f.current.resizeObserver=null)}function w(){f.current.element&&(f.current.resizeObserver=new c(v),f.current.resizeObserver.observe(f.current.element),t&&f.current.scrollContainers&&f.current.scrollContainers.forEach(a=>a.addEventListener("scroll",v,{capture:!0,passive:!0})))}const d=a=>{!a||a===f.current.element||(h(),f.current.element=a,f.current.scrollContainers=vt(a),w())};return Dr(v,!!t),Tr(l),m.useEffect(()=>{h(),w()},[t,v,l]),m.useEffect(()=>h,[]),[d,s,n]}function Tr(e){m.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Dr(e,t){m.useEffect(()=>{if(t){const o=e;return window.addEventListener("scroll",o,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",o,!0)}},[e,t])}function vt(e){const t=[];if(!e||e===document.body)return t;const{overflow:o,overflowX:i,overflowY:c}=window.getComputedStyle(e);return[o,i,c].some(s=>s==="auto"||s==="scroll")&&t.push(e),[...t,...vt(e.parentElement)]}const zr=["x","y","top","bottom","left","right","width","height"],Ir=(e,t)=>zr.every(o=>e[o]===t[o]),Fr=m.forwardRef(function({children:t,fallback:o,resize:i,style:c,gl:s,events:y=Lr,eventSource:f,eventPrefix:u,shadows:g,linear:r,flat:n,legacy:l,orthographic:v,frameloop:h,dpr:w,performance:d,raycaster:a,camera:p,scene:b,onPointerMissed:_,onCreated:E,...M},S){m.useMemo(()=>Ae(Ft),[]);const x=Qt(),[R,P]=Ar({scroll:!0,debounce:{scroll:50,resize:0},...i}),C=m.useRef(null),O=m.useRef(null);m.useImperativeHandle(S,()=>C.current);const z=ot(_),[X,ee]=m.useState(!1),[Y,te]=m.useState(!1);if(X)throw X;if(Y)throw Y;const F=m.useRef(null);Z(()=>{const A=C.current;P.width>0&&P.height>0&&A&&(F.current||(F.current=Rr(A)),F.current.configure({gl:s,events:y,shadows:g,linear:r,flat:n,legacy:l,orthographic:v,frameloop:h,dpr:w,performance:d,raycaster:a,camera:p,scene:b,size:P,onPointerMissed:(...k)=>z.current==null?void 0:z.current(...k),onCreated:k=>{k.events.connect==null||k.events.connect(f?fr(f)?f.current:f:O.current),u&&k.setEvents({compute:(W,L)=>{const ue=W[u+"X"],re=W[u+"Y"];L.pointer.set(ue/L.size.width*2-1,-(re/L.size.height)*2+1),L.raycaster.setFromCamera(L.pointer,L.camera)}}),E==null||E(k)}}),F.current.render(T.jsx(x,{children:T.jsx(it,{set:te,children:T.jsx(m.Suspense,{fallback:T.jsx(dr,{set:ee}),children:t})})})))}),m.useEffect(()=>{const A=C.current;if(A)return()=>ht(A)},[]);const G=f?"none":"auto";return T.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:G,...c},...M,children:T.jsx("div",{ref:R,style:{width:"100%",height:"100%"},children:T.jsx("canvas",{ref:C,style:{display:"block"},children:o})})})}),pn=m.forwardRef(function(t,o){return T.jsx(Jt,{children:T.jsx(Fr,{...t,ref:o})})});function mt(e,t,o,i){const c=class extends Bt{constructor(y={}){const f=Object.entries(e);super({uniforms:f.reduce((u,[g,r])=>{const n=Ht.clone({[g]:{value:r}});return{...u,...n}},{}),vertexShader:t,fragmentShader:o}),this.key="",f.forEach(([u])=>Object.defineProperty(this,u,{get:()=>this.uniforms[u].value,set:g=>this.uniforms[u].value=g})),Object.assign(this,y)}};return c.key=ae.generateUUID(),c}const _e=e=>e===Object(e)&&!Array.isArray(e)&&typeof e!="function";function gt(e,t){const o=B(s=>s.gl),i=H(je,_e(e)?Object.values(e):e);return m.useLayoutEffect(()=>{t==null||t(i)},[t]),m.useEffect(()=>{if("initTexture"in o){let s=[];Array.isArray(i)?s=i:i instanceof Se?s=[i]:_e(i)&&(s=Object.values(i)),s.forEach(y=>{y instanceof Se&&o.initTexture(y)})}},[o,i]),m.useMemo(()=>{if(_e(e)){const s={};let y=0;for(const f in e)s[f]=i[y++];return s}else return i},[e,i])}gt.preload=e=>H.preload(je,e);gt.clear=e=>H.clear(je,e);const Br=()=>parseInt(Gt.replace(/\D+/g,"")),yt=Br();function Hr(e){return Array.isArray(e)}function Ce(e=[0,0,0]){return Hr(e)?e:e instanceof I||e instanceof Ze?[e.x,e.y,e.z]:[e,e,e]}const vn=m.forwardRef(function({debug:t,depthTest:o=!1,polygonOffsetFactor:i=-10,map:c,mesh:s,children:y,position:f,rotation:u,scale:g,...r},n){const l=m.useRef(null);m.useImperativeHandle(n,()=>l.current);const v=m.useRef(null);return m.useLayoutEffect(()=>{const h=(s==null?void 0:s.current)||l.current.parent,w=l.current;if(!(h instanceof Wt))throw new Error('Decal must have a Mesh as parent or specify its "mesh" prop');const d={position:new I,rotation:new Ze,scale:new I(1,1,1)};if(h){D(d,{position:f,scale:g});const a=h.matrixWorld.clone();if(h.matrixWorld.identity(),!u||typeof u=="number"){const p=new Ut;p.position.copy(d.position),p.lookAt(h.position),typeof u=="number"&&p.rotateZ(u),D(d,{rotation:p.rotation})}else D(d,{rotation:u});return w.geometry=new er(h,d.position,d.rotation,d.scale),v.current&&(D(v.current,d),v.current.traverse(p=>p.raycast=()=>null)),h.matrixWorld=a,()=>{w.geometry.dispose()}}},[s,...Ce(f),...Ce(g),...Ce(u)]),m.createElement("mesh",ce({ref:l,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":i,"material-depthTest":o,"material-map":c},r),y,t&&m.createElement("mesh",{ref:v},m.createElement("boxGeometry",null),m.createElement("meshNormalMaterial",{wireframe:!0}),m.createElement("axesHelper",null)))});let ie=null,wt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function bt(e,t,o){return i=>{o&&o(i),e&&(ie||(ie=new tr),ie.setDecoderPath(typeof e=="string"?e:wt),i.setDRACOLoader(ie)),t&&i.setMeshoptDecoder(typeof pe=="function"?pe():pe)}}function ze(e,t=!0,o=!0,i){return H(ke,e,bt(t,o,i))}ze.preload=(e,t=!0,o=!0,i)=>H.preload(ke,e,bt(t,o,i));ze.clear=e=>H.clear(ke,e);ze.setDecoderPath=e=>{wt=e};const mn=m.forwardRef(function({children:t,disable:o,disableX:i,disableY:c,disableZ:s,left:y,right:f,top:u,bottom:g,front:r,back:n,onCentered:l,precise:v=!0,cacheKey:h=0,...w},d){const a=m.useRef(null),p=m.useRef(null),b=m.useRef(null);return m.useLayoutEffect(()=>{p.current.matrixWorld.identity();const _=new $t().setFromObject(b.current,v),E=new I,M=new Nt,S=_.max.x-_.min.x,x=_.max.y-_.min.y,R=_.max.z-_.min.z;_.getCenter(E),_.getBoundingSphere(M);const P=u?x/2:g?-x/2:0,C=y?-S/2:f?S/2:0,O=r?R/2:n?-R/2:0;p.current.position.set(o||i?0:-E.x+C,o||c?0:-E.y+P,o||s?0:-E.z+O),typeof l<"u"&&l({parent:a.current.parent,container:a.current,width:S,height:x,depth:R,boundingBox:_,boundingSphere:M,center:E,verticalAlignment:P,horizontalAlignment:C,depthAlignment:O})},[h,l,u,y,r,o,i,c,s,v,f,g,n]),m.useImperativeHandle(d,()=>a.current,[]),m.createElement("group",ce({ref:a},w),m.createElement("group",{ref:p},m.createElement("group",{ref:b},t)))}),Gr=3e3,Wr=3001,Ur=mt({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }"),Me={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},$r="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",se=e=>Array.isArray(e);function Et({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:t="",preset:o=void 0,encoding:i=void 0,extensions:c}={}){var s;let y=null,f=!1;if(o){if(!(o in Me))throw new Error("Preset must be one of: "+Object.keys(Me).join(", "));e=Me[o],t=$r}const u=se(e)&&e.length===6,g=se(e)&&e.length===3&&e.some(d=>d.endsWith("json")),r=se(e)?e[0]:e;f=se(e);const n=u?"cube":g?"webp":r.startsWith("data:application/exr")?"exr":r.startsWith("data:application/hdr")?"hdr":r.startsWith("data:image/jpeg")?"jpg":(s=r.split(".").pop())==null||(s=s.split("?"))==null||(s=s.shift())==null?void 0:s.toLowerCase();if(y=n==="cube"?Xt:n==="hdr"?rr:n==="exr"?nr:n==="jpg"||n==="jpeg"?ir:n==="webp"?sr:null,!y)throw new Error("useEnvironment: Unrecognized file extension: "+e);const l=B(d=>d.gl);m.useLayoutEffect(()=>{if(n!=="webp"&&n!=="jpg"&&n!=="jpeg")return;function d(){H.clear(y,f?[e]:e)}l.domElement.addEventListener("webglcontextlost",d,{once:!0})},[e,l.domElement]);const v=H(y,f?[e]:e,d=>{(n==="webp"||n==="jpg"||n==="jpeg")&&d.setRenderer(l),d.setPath==null||d.setPath(t),c&&c(d)});let h=f?v[0]:v;if(n==="jpg"||n==="jpeg"||n==="webp"){var w;h=(w=h.renderTarget)==null?void 0:w.texture}return h.mapping=u?qt:Vt,"colorSpace"in h?h.colorSpace=i??u?"srgb":"srgb-linear":h.encoding=i??u?Wr:Gr,h}const Nr=e=>e.current&&e.current.isScene,qr=e=>Nr(e)?e.current:e;function Ie(e,t,o,i,c={}){var s,y,f,u,g;c={backgroundBlurriness:(s=c.blur)!==null&&s!==void 0?s:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...c};const r=qr(t||o),n=r.background,l=r.environment,v={backgroundBlurriness:r.backgroundBlurriness,backgroundIntensity:r.backgroundIntensity,backgroundRotation:(y=(f=r.backgroundRotation)==null||f.clone==null?void 0:f.clone())!==null&&y!==void 0?y:[0,0,0],environmentIntensity:r.environmentIntensity,environmentRotation:(u=(g=r.environmentRotation)==null||g.clone==null?void 0:g.clone())!==null&&u!==void 0?u:[0,0,0]};return e!=="only"&&(r.environment=i),e&&(r.background=i),D(r,c),()=>{e!=="only"&&(r.environment=l),e&&(r.background=n),D(r,v)}}function Fe({scene:e,background:t=!1,map:o,...i}){const c=B(s=>s.scene);return m.useLayoutEffect(()=>{if(o)return Ie(t,e,c,o,i)}),null}function _t({background:e=!1,scene:t,blur:o,backgroundBlurriness:i,backgroundIntensity:c,backgroundRotation:s,environmentIntensity:y,environmentRotation:f,...u}){const g=Et(u),r=B(n=>n.scene);return m.useLayoutEffect(()=>Ie(e,t,r,g,{blur:o,backgroundBlurriness:i,backgroundIntensity:c,backgroundRotation:s,environmentIntensity:y,environmentRotation:f})),null}function Vr({children:e,near:t=1,far:o=1e3,resolution:i=256,frames:c=1,map:s,background:y=!1,blur:f,backgroundBlurriness:u,backgroundIntensity:g,backgroundRotation:r,environmentIntensity:n,environmentRotation:l,scene:v,files:h,path:w,preset:d=void 0,extensions:a}){const p=B(x=>x.gl),b=B(x=>x.scene),_=m.useRef(null),[E]=m.useState(()=>new xe),M=m.useMemo(()=>{const x=new Yt(i);return x.texture.type=et,x},[i]);m.useLayoutEffect(()=>(c===1&&_.current.update(p,E),Ie(y,v,b,M.texture,{blur:f,backgroundBlurriness:u,backgroundIntensity:g,backgroundRotation:r,environmentIntensity:n,environmentRotation:l})),[e,E,M.texture,v,b,y,c,p]);let S=1;return dt(()=>{(c===1/0||S<c)&&(_.current.update(p,E),S++)}),m.createElement(m.Fragment,null,jr(m.createElement(m.Fragment,null,e,m.createElement("cubeCamera",{ref:_,args:[t,o,M]}),h||d?m.createElement(_t,{background:!0,files:h,preset:d,path:w,extensions:a}):s?m.createElement(Fe,{background:!0,map:s,extensions:a}):null),E))}function Xr(e){var t,o,i,c;const s=Et(e),y=e.map||s;m.useMemo(()=>Ae({GroundProjectedEnvImpl:or}),[]);const f=m.useMemo(()=>[y],[y]),u=(t=e.ground)==null?void 0:t.height,g=(o=e.ground)==null?void 0:o.radius,r=(i=(c=e.ground)==null?void 0:c.scale)!==null&&i!==void 0?i:1e3;return m.createElement(m.Fragment,null,m.createElement(Fe,ce({},e,{map:y})),m.createElement("groundProjectedEnvImpl",{args:f,scale:r,height:u,radius:g}))}function gn(e){return e.ground?m.createElement(Xr,e):e.map?m.createElement(Fe,e):e.children?m.createElement(Vr,e):m.createElement(_t,e)}function Yr(e){return e.isLight}function Kr(e){return!!e.geometry}const Ct=m.createContext(null),Jr=mt({color:new Oe,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${yt>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),yn=m.forwardRef(({children:e,temporal:t,frames:o=40,limit:i=1/0,blend:c=20,scale:s=10,opacity:y=1,alphaTest:f=.75,color:u="black",colorBlend:g=2,resolution:r=1024,toneMapped:n=!0,...l},v)=>{Ae({SoftShadowMaterial:Jr});const h=B(M=>M.gl),w=B(M=>M.scene),d=B(M=>M.camera),a=B(M=>M.invalidate),p=m.useRef(null),b=m.useRef(null),[_]=m.useState(()=>new Qr(h,w,r));m.useLayoutEffect(()=>{_.configure(p.current)},[]);const E=m.useMemo(()=>({lights:new Map,temporal:!!t,frames:Math.max(2,o),blend:Math.max(2,o===1/0?c:o),count:0,getMesh:()=>p.current,reset:()=>{_.clear();const M=p.current.material;M.opacity=0,M.alphaTest=0,E.count=0},update:(M=1)=>{const S=p.current.material;E.temporal?(S.opacity=Math.min(y,S.opacity+y/E.blend),S.alphaTest=Math.min(f,S.alphaTest+f/E.blend)):(S.opacity=y,S.alphaTest=f),b.current.visible=!0,_.prepare();for(let x=0;x<M;x++)E.lights.forEach(R=>R.update()),_.update(d,E.blend);b.current.visible=!1,_.finish()}}),[_,d,w,t,o,c,y,f]);return m.useLayoutEffect(()=>{E.reset(),!E.temporal&&E.frames!==1/0&&E.update(E.blend)}),m.useImperativeHandle(v,()=>E,[E]),dt(()=>{(E.temporal||E.frames===1/0)&&E.count<E.frames&&E.count<i&&(a(),E.update(),E.count++)}),m.createElement("group",l,m.createElement("group",{traverse:()=>null,ref:b},m.createElement(Ct.Provider,{value:E},e)),m.createElement("mesh",{receiveShadow:!0,ref:p,scale:s,rotation:[-Math.PI/2,0,0]},m.createElement("planeGeometry",null),m.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:n,color:u,blend:g,map:_.progressiveLightMap2.texture})))}),wn=m.forwardRef(({castShadow:e=!0,bias:t=.001,mapSize:o=512,size:i=5,near:c=.5,far:s=500,frames:y=1,position:f=[0,0,0],radius:u=1,amount:g=8,intensity:r=yt>=155?Math.PI:1,ambient:n=.5,...l},v)=>{const h=m.useRef(null),w=new I(...f).length(),d=m.useContext(Ct),a=m.useCallback(()=>{let b;if(h.current)for(let _=0;_<h.current.children.length;_++)if(b=h.current.children[_],Math.random()>n)b.position.set(f[0]+ae.randFloatSpread(u),f[1]+ae.randFloatSpread(u),f[2]+ae.randFloatSpread(u));else{let E=Math.acos(2*Math.random()-1)-Math.PI/2,M=2*Math.PI*Math.random();b.position.set(Math.cos(E)*Math.cos(M)*w,Math.abs(Math.cos(E)*Math.sin(M)*w),Math.sin(E)*w)}},[u,n,w,...f]),p=m.useMemo(()=>({update:a}),[a]);return m.useImperativeHandle(v,()=>p,[p]),m.useLayoutEffect(()=>{var b;const _=h.current;return d&&((b=d.lights)==null||b.set(_.uuid,p)),()=>{var E;return void(d==null||(E=d.lights)==null?void 0:E.delete(_.uuid))}},[d,p]),m.createElement("group",ce({ref:h},l),Array.from({length:g},(b,_)=>m.createElement("directionalLight",{key:_,castShadow:e,"shadow-bias":t,"shadow-mapSize":[o,o],intensity:r/g},m.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,c,s]}))))});class Qr{constructor(t,o,i=1024){this.renderer=t,this.res=i,this.scene=o,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new Oe,this.clearAlpha=0;const c={type:et,magFilter:He,minFilter:He};this.progressiveLightMap1=new Be(this.res,this.res,c),this.progressiveLightMap2=new Be(this.res,this.res,c),this.discardMat=new Ur,this.targetMat=new Kt({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=s=>{s.vertexShader=`varying vec2 vUv;
`+s.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";const y=s.fragmentShader.indexOf("void main() {");s.fragmentShader=`varying vec2 vUv;
`+s.fragmentShader.slice(0,y)+`uniform sampler2D previousShadowMap;
	uniform float averagingWindow;
`+s.fragmentShader.slice(y-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,s.uniforms.previousShadowMap=this.previousShadowMap,s.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(t=>{Kr(t)?this.meshes.push({object:t,material:t.material}):Yr(t)&&this.lights.push({object:t,intensity:t.intensity})})}prepare(){this.lights.forEach(t=>t.object.intensity=0),this.meshes.forEach(t=>t.object.material=this.discardMat)}finish(){this.lights.forEach(t=>t.object.intensity=t.intensity),this.meshes.forEach(t=>t.object.material=t.material)}configure(t){this.object=t}update(t,o=100){if(!this.object)return;this.averagingWindow.value=o,this.object.material=this.targetMat;const i=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,c=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,s=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(i),this.previousShadowMap.value=c.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,t),this.renderer.setRenderTarget(null),this.scene.background=s}}export{yn as A,pn as C,vn as D,gn as E,wn as R,gt as a,dt as b,mn as c,ze as u};
